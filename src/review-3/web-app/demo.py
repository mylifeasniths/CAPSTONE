import numpy as np
from PIL import Image,ImageOps,ImageGrab
import io
import base64
import joblib

fileName = 'random'
string = 'data:image/jpeg;base64,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'

def url_to_image(url):
	url = str.encode(string.split(';base64,')[1])
	b = base64.b64decode(url)
	image_bytes = io.BytesIO(b)
	img = Image.open(image_bytes)
	# img = img.convert('LA')
	# img = img.resize((28,28), Image.ANTIALIAS)

	img = ImageOps.invert(img)
	img.save(fileName + "_negative" + ".jpg")

	# Resize and convert it into greyscale
	img = img.resize((28,28))
	img = img.convert('L')
	img.save(fileName + "_28x28" + ".jpg")

	# Convert it into Numpy array
	img = np.array(img)
	img_norm = img.astype('float32')
	img_norm = img_norm / 255.0
	img_norm = img_norm.reshape((1,28*28))
	return img_norm

classifier = joblib.load('svm_model.gz')
img = url_to_image(string)
digit = classifier.predict(img)
print('Output:',digit)


# def url_to_image(url):
# 	url = str.encode(string.split(';base64,')[1])
# 	b = base64.b64decode(url)
# 	image_bytes = io.BytesIO(b)
# 	img = Image.open(image_bytes)
# 	img = img.resize((28,28), Image.ANTIALIAS)
# 	img = img.convert('LA')
# 	img.show()